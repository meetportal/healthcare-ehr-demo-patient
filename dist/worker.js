(function(){"use strict";var j=Object.defineProperty,Q=(i,t,n)=>t in i?j(i,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[t]=n,s=(i,t,n)=>(Q(i,typeof t!="symbol"?t+"":t,n),n),v=(i,t,n)=>{if(!t.has(i))throw TypeError("Cannot "+n)},a=(i,t,n)=>(v(i,t,"read from private field"),n?n.call(i):t.get(i)),O=(i,t,n)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,n)},T=(i,t,n,o)=>(v(i,t,"write to private field"),o?o.call(i,n):t.set(i,n),n);const B=self,C=!!B.WorkerGlobalScope,Y=C||`${self.name??""}`.startsWith("portal"),Z={MAXIMIZE:"maximize",MINIMIZE:"minimize",RESTORE:"restore",SET_BADGE:"setBadge",CLOSE:"closeApp",ON_MAXIMIZE:"maximize",ON_MINIMIZE:"minimize",ON_RESTORE:"restore"},L="connection",$={DISCONNECT:L+".disconnect",ON_DISCONNECT:L+".onDisconnect"},E="element",z={ADD:E+".add",FIND:E+".find",EXISTS:E+".exists",REMOVE:E+".remove",REPLACE:E+".replace",ADD_STYLES:E+".addStyles",RESTORE_STYLES:E+".restoreStyles",REMOVE_CLASSES:E+".removeClasses",QUERY:E+".query",ON_TOGGLE:E+".onToggle",ON_MUTATION:E+".onMutation",ON_CLICK:E+".onClick",ON_MOUSE_OVER:E+".onMouseOver",ON_HOVER:E+".onHover",ON_MOUSEDOWN:E+".onMouseDown",ON_MOUSEUP:E+".onMouseUp"},M="cookie",m="sessionStorage",A="localStorage",x="cookieStore",X={GET_COOKIE:M+".getItem",SET_COOKIE:M+".setItem",GET_SESSION_STORAGE_ITEM:m+".getItem",SET_SESSION_STORAGE_ITEM:m+".setItem",GET_LOCAL_STORAGE_ITEM:A+".getItem",SET_LOCAL_STORAGE_ITEM:A+".setItem",GET_COOKIE_STORE_ITEM:x+".get",SET_COOKIE_STORE_ITEM:x+".set",ON_COOKIE_CHANGE:M+".onChange",ON_SESSION_STORAGE_CHANGE:m+".onChange",ON_LOCAL_STORAGE_CHANGE:A+".onChange",ON_COOKIE_STORE_CHANGE:x+".onChange"},H="window",F={GET_URL:H+".getUrl",ON_URL_CHANGE:H+".onUrlChange"},G=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){var t=Math.random()*16|0,n=i=="x"?t:t&3|8;return n.toString(16)}),w={PUSH:"pushNotification",CLEAR:"clearNotifications",ON_CLICK:"notificationClick"},f={SET_RESOURCE:"setResource",CLEAR_RESOURCE:"clearResource",ON_CHANGE:"resourceChange"},k={GET_SESSION:"getSession",ON_CHANGE:"sessionChange"},U={SET_ITEM:"setStoreItem",GET_ITEM:"getStoreItem",REMOVE_ITEM:"removeStoreItem",...X},R={ECHO:"echo",REQUEST_PERMISSIONS:"requestPermissions",SEND_MESSAGE:"sendMessage",OPEN_APP:"openApp",ON_MESSAGE:"message"},D={SET_USER:"setUser",ON_CHANGE:"userChange"},W="0.4.2";var d,_,g,N,p,P,u,b,I;class J{constructor(t,n,o){s(this,"id"),O(this,d,null),O(this,_,[]),O(this,g,new Map),O(this,N,new Map),O(this,p,0),O(this,P,"*"),O(this,u,void 0),s(this,"openApp",(e,r)=>this.sendRequest(R.OPEN_APP,{appId:e,message:r})),O(this,b,(e,r,h=a(this,p))=>new Promise((S,c)=>{let l=null;h&&(l=setTimeout(()=>{c(new Error("timeout"))},h)),a(this,g).set(e,{path:r,timer:l,resolve:S,reject:c})})),O(this,I,async e=>{if(a(this,_).push(e),clearTimeout(a(this,d)),a(this,_).length>=10){this.postMessage({batch:a(this,_)}),a(this,_).length=0;return}T(this,d,setTimeout(()=>{this.postMessage({batch:a(this,_)}),a(this,_).length=0},1))}),s(this,"postMessage",e=>{C?a(this,u).postMessage(e):Y&&a(this,u).postMessage(e,a(this,P))}),s(this,"setContext",e=>{T(this,u,e)}),s(this,"sendRequest",async(e,...r)=>{const h=G();return a(this,I).call(this,{id:h,path:e,version:W,args:r}),a(this,b).call(this,h,e)}),s(this,"subscribe",(e,r="*",h)=>{const S=G();return a(this,N).set(S,h),a(this,I).call(this,{id:S,version:W,path:"on."+e,args:[r]}),()=>{a(this,N).delete(S),setTimeout(()=>{this.postMessage({id:S,path:"off."+e,args:[r]})},0)}}),s(this,"disconnect",()=>{a(this,u)&&this.postMessage({id:this.id,path:$.DISCONNECT})}),s(this,"echo",e=>this.sendRequest(R.ECHO,e)),s(this,"requestPermissions",e=>this.sendRequest(R.REQUEST_PERMISSIONS,e)),s(this,"getSession",async()=>this.sendRequest(k.GET_SESSION)),s(this,"setBadge",e=>this.sendRequest(Z.SET_BADGE,e)),s(this,"pushNotification",e=>this.sendRequest(w.PUSH,e)),s(this,"clearNotifications",e=>this.sendRequest(w.CLEAR,e)),s(this,"setStoreItem",(e,r,h)=>this.sendRequest(U.SET_ITEM,e,r,h)),s(this,"getStoreItem",async(e,r,h)=>this.sendRequest(U.GET_ITEM,e,h).then(S=>S??r?r:S)),s(this,"removeStoreItem",(e,r)=>this.sendRequest(U.REMOVE_ITEM,e,r)),s(this,"onSessionChange",e=>this.subscribe(k.ON_CHANGE,"*",e)),s(this,"onResourceChange",(e="*",r)=>this.subscribe(f.ON_CHANGE,e,r)),s(this,"onMessage",e=>this.subscribe(w.ON_CLICK,"*",e)),s(this,"onUserChange",e=>()=>this.subscribe(D.ON_CHANGE,"*",e)),o&&T(this,p,o.requestTimeout||0),this.id=G(),T(this,u,t),n.addEventListener("message",e=>{const{id:r,data:h,error:S}=e.data,c=a(this,g).get(r);if(c)c.timer&&clearTimeout(c.timer),a(this,g).delete(r),S?c.reject(S):c.resolve(h);else{const l=a(this,N).get(r);l&&l(h)}})}}d=new WeakMap,_=new WeakMap,g=new WeakMap,N=new WeakMap,p=new WeakMap,P=new WeakMap,u=new WeakMap,b=new WeakMap,I=new WeakMap;class ee extends J{constructor(t,n){super(t,t,n),s(this,"query",async o=>{const e=typeof o=="string"?o:o.toString();return await this.sendRequest(z.QUERY,e)}),s(this,"openApp",(o,e)=>this.sendRequest(R.OPEN_APP,{appId:o,message:e})),s(this,"setResource",o=>this.sendRequest(f.SET_RESOURCE,o)),s(this,"clearResource",o=>this.sendRequest(f.CLEAR_RESOURCE,o)),s(this,"setUser",o=>this.sendRequest(D.SET_USER,o)),s(this,"sendMessage",o=>this.sendRequest(R.SEND_MESSAGE,o)),s(this,"generatePathFromProxy",o=>{const e=[],r={get(h,S){return e.push(S.toString()),new Proxy(()=>{},r)},apply(h,S,c){const l=c.map(se=>JSON.stringify(se)).join(", "),V=e[e.length-1];return V==="toString"?e.slice(0,-1).join("."):(e[e.length-1]=`${V}(${l})`,new Proxy(()=>{},r))}};return new Proxy(()=>{},r)}),s(this,"requestPermissions",o=>this.sendRequest(R.REQUEST_PERMISSIONS,o))}}let q;const te=()=>{if(!C)throw new Error("usePortalService must be called from a web worker");return q||(q=new ee(self)),q},K="patient",y=te();console.log("ðŸ“¦ healthcare-ehr-demo-patient loaded..."),y.subscribe(F.ON_URL_CHANGE,"*",i=>{if(!i)return;console.log("ðŸ“¦ url",i);const t=new RegExp("/\\d+$"),n=i.match(t),o=(n!=null&&n.length?n[0]:"").substring(1);console.log("ðŸ“¦ patientId",o),o?y.setResource({id:o,type:K}):y.clearResource(K)})})();
